@{
    ViewData["Title"] = "Markdown Reader";
}

@if (User.Identity?.IsAuthenticated != true)
{
    <!-- Landing Page for Unauthenticated Users -->
    <div class="landing-page">
        <div class="landing-background">
            <div class="gradient-orb orb-1"></div>
            <div class="gradient-orb orb-2"></div>
            <div class="gradient-orb orb-3"></div>
        </div>
        <div class="landing-content">
            <div class="landing-hero">
                <div class="hero-badge">
                    <span>✨ Modern Markdown Editor</span>
                </div>
                <div class="hero-icon-wrapper">
                    <div class="hero-icon-glow"></div>
                    <div class="hero-icon">
                        <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                        </svg>
                    </div>
                </div>
                <h1 class="landing-title">
                    <span class="title-main">.md File Reader</span>
                    <span class="title-accent">Write. Preview. Export.</span>
                </h1>
                <p class="landing-subtitle">A powerful, modern markdown editor with real-time preview, intelligent document management, and seamless export capabilities</p>
                <div class="landing-features">
                    <div class="feature-item" style="animation-delay: 0.1s;">
                        <div class="feature-icon-wrapper">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="16 18 22 12 16 6"></polyline>
                                <polyline points="8 6 2 12 8 18"></polyline>
                            </svg>
                        </div>
                        <h3>Live Preview</h3>
                        <p>See your markdown rendered in real-time as you type</p>
                    </div>
                    <div class="feature-item" style="animation-delay: 0.2s;">
                        <div class="feature-icon-wrapper">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                            </svg>
                        </div>
                        <h3>Smart Management</h3>
                        <p>Organize and access all your documents effortlessly</p>
                    </div>
                    <div class="feature-item" style="animation-delay: 0.3s;">
                        <div class="feature-icon-wrapper">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                        </div>
                        <h3>Export Anywhere</h3>
                        <p>Export to PDF or Word with professional formatting</p>
                    </div>
                </div>
                <form asp-controller="Account" asp-action="SignIn" method="post" class="landing-login-form">
                    <button type="submit" class="btn-github-login">
                        <span class="btn-shine"></span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
                        </svg>
                        <span>Continue with GitHub</span>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-arrow">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </button>
                </form>
                <div class="landing-footer">
                    <p>Secure authentication • Unlimited for admins • 500 documents per user</p>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <!-- Editor for Authenticated Users -->
    <div class="container-fluid p-0" style="height: 100%; display: flex; flex-direction: column;">
    <div class="row g-0" style="flex: 1; overflow: hidden; margin: 0; height: 100%; position: relative;">
        <!-- Sidebar Backdrop (Mobile) -->
        <div class="sidebar-backdrop" id="sidebar-backdrop" onclick="toggleSidebar()"></div>
        
        <!-- Left Sidebar - Saved Documents -->
        <div class="documents-sidebar" id="sidebar" style="position: absolute; left: 0; top: 0;">
            <div class="sidebar-header">
                <div class="sidebar-title">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="sidebar-icon">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                    </svg>
                    <div style="display: flex; flex-direction: column; gap: 2px;">
                        <span class="sidebar-title-text">Documents</span>
                        <span id="document-count" class="document-count" style="font-size: 0.75rem; font-weight: 400; opacity: 0.7;">0 / 500</span>
                    </div>
                </div>
                <button class="sidebar-toggle-btn" id="sidebar-close-btn" onclick="toggleSidebar()" aria-label="Close sidebar">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="sidebar-content">
                <div id="documents-list">
                    <div class="text-muted text-center">Loading...</div>
                </div>
            </div>
        </div>

        <!-- Sidebar Toggle Button (when hidden) -->
        <button class="sidebar-toggle-fab" id="sidebar-open-btn" onclick="toggleSidebar()" aria-label="Open sidebar" style="display: none;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
            </svg>
        </button>

        <!-- Main Content Area -->
        <div class="main-content-area d-flex" style="overflow: hidden; height: 100%;">
            <!-- Markdown Input Panel -->
            <div class="d-flex flex-column border-end" id="input-panel" style="overflow: hidden; width: 50%; flex-shrink: 0;">
                <div class="border-bottom" style="flex-shrink: 0;">
                    <div class="d-flex justify-content-between align-items-center p-3">
                        <h6 class="mb-0" style="text-align: left;">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 6px;">
                                <polyline points="16 18 22 12 16 6"></polyline>
                                <polyline points="8 6 2 12 8 18"></polyline>
                            </svg>
                            Editor
                        </h6>
                        <div>
                            <input type="file" id="file-input" accept=".md" style="display: none;" />
                            <button class="btn btn-sm btn-outline-secondary" onclick="document.getElementById('file-input').click()">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 4px;">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                                Upload
                            </button>
                        </div>
                    </div>
                </div>
                <textarea id="markdown-input" class="form-control border-0 flex-grow-1" 
                          style="resize: none; min-height: 0;"
                          placeholder="Start typing your markdown here...&#10;&#10;Try:&#10;# Heading&#10;## Subheading&#10;**Bold text**&#10;*Italic text*&#10;```code```"></textarea>
            </div>

            <!-- Resizer -->
            <div class="resizer" id="middle-resizer" style="flex-shrink: 0; width: 4px;"></div>

            <!-- Preview Panel -->
            <div class="d-flex flex-column" id="preview-panel" style="overflow: hidden; width: 50%; flex-shrink: 0;">
                <div class="border-bottom" style="flex-shrink: 0;">
                    <div class="d-flex justify-content-between align-items-center p-3">
                        <h6 class="mb-0" style="text-align: left;">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 6px;">
                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                            </svg>
                            Preview
                        </h6>
                        <div>
                            <button class="btn btn-sm btn-outline-secondary" onclick="newDocument()">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 4px;">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                New
                            </button>
                            <div class="btn-group ms-2">
                                <button type="button" class="btn btn-sm btn-primary dropdown-toggle" data-bs-toggle="dropdown">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 4px;">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7 10 12 15 17 10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                    Export
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#" onclick="exportDocument('pdf'); return false;">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 6px;">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                            <polyline points="14 2 14 8 20 8"></polyline>
                                            <line x1="16" y1="13" x2="8" y2="13"></line>
                                            <line x1="16" y1="17" x2="8" y2="17"></line>
                                        </svg>
                                        Export as PDF
                                    </a></li>
                                    <li><a class="dropdown-item" href="#" onclick="exportDocument('word'); return false;">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 6px;">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                            <polyline points="14 2 14 8 20 8"></polyline>
                                            <line x1="16" y1="13" x2="8" y2="13"></line>
                                            <line x1="16" y1="17" x2="8" y2="17"></line>
                                        </svg>
                                        Export as Word
                                    </a></li>
                                </ul>
                            </div>
                            <button class="btn btn-sm btn-success ms-2" id="save-btn" onclick="saveDocument()">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 4px;">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                                    <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                    <polyline points="7 3 7 8 15 8"></polyline>
                                </svg>
                                Save
                            </button>
                        </div>
                    </div>
                </div>
                <div id="markdown-preview" class="p-4 flex-grow-1" 
                     style="overflow-y: auto; min-height: 0;">
                    <div class="empty-state">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.3">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                        <p style="margin-top: 1rem; font-size: 0.9rem;">Start writing to see the preview</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
}

@section Scripts {
    @if (User.Identity?.IsAuthenticated == true)
    {
        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
        <script src="~/js/app.js" asp-append-version="true"></script>
    }
}
